import streamlit as st
import yaml
from yaml.loader import SafeLoader
import streamlit_authenticator as stauth

from main_app import render_main_app
from welcome_page import render_welcome_page

st.set_page_config(
    page_title="Signal Prime | Smart Money Scanner",
    page_icon="ğŸ§ ",
    layout="wide",
)

# --- ØªØ­Ù…ÙŠÙ„ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ---
try:
    with open('config.yaml') as file:
        config = yaml.load(file, Loader=SafeLoader)
except FileNotFoundError:
    st.error("Error: The 'config.yaml' file was not found.")
    st.stop()

# --- ØªÙ‡ÙŠØ¦Ø© Ø£Ø¯Ø§Ø© Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© ---
authenticator = stauth.Authenticate(
    config['credentials'],
    config['cookie']['name'],
    config['cookie']['key'],
    config['cookie']['expiry_days']
)

# --- Ø§Ù„Ù…Ù†Ø·Ù‚ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ù„Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ø¹Ø±Ø¶ ---
if st.session_state.get("authentication_status"):
    # Ø¥Ø°Ø§ Ù†Ø¬Ø­ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ØŒ Ø§Ø¹Ø±Ø¶ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
    render_main_app()
    with st.sidebar:
        st.write(f'Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ *{st.session_state["name"]}*')
        authenticator.logout('ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬', 'main')
else:
    # Ø¥Ø°Ø§ Ù„Ù… ÙŠØ³Ø¬Ù„ Ø¯Ø®ÙˆÙ„Ù‡ØŒ Ø§Ø¹Ø±Ø¶ Ø§Ù„ØµÙØ­Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨ÙŠØ© ÙˆÙ…Ø±Ø± Ù„Ù‡Ø§ Ø£Ø¯Ø§Ø© Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©
    render_welcome_page(authenticator)
